<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDK Facebook Meta Cloud v.1</title>
</head>

<body>

    <!-- The JS SDK Login Button -->
<fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
</fb:login-button>
<div id="status">
</div>

<script>
    var fbReady = false;

    window.fbAsyncInit = function() {
        FB.init({
            appId: '{529419924881734}',
            cookie: true,
            xfbml: true,
            version: 'v18.0'
        });

        fbReady = true; // SDK do Facebook inicializado

        FB.getLoginStatus(function(response) {   
            statusChangeCallback(response);        
        });
    };

    function checkLoginState() {
        if(fbReady) {
            FB.getLoginStatus(function(response) {
                statusChangeCallback(response);
            });
        } else {
            setTimeout(checkLoginState, 50); // Espera por 50ms e tenta novamente
        }
    }

    function statusChangeCallback(response) {
        console.log('statusChangeCallback');
        console.log(response);
        if (response.status === 'connected') {
            testAPI();
        } else {
            document.getElementById('status').innerHTML = 'Por favor, faça login nesta página.';
        }
    }

    function testAPI() {
        console.log('Bem-vindo! Buscando suas informações.... ');
        FB.api('/me', function(response) {
            console.log('Login bem-sucedido para: ' + response.name);
            document.getElementById('status').innerHTML =
                'Obrigado por fazer login, ' + response.name + '!';
        });
    }
</script>

<!-- Load the JS SDK asynchronously -->
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

</body>

</html>
